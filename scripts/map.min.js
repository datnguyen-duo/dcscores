document.addEventListener("DOMContentLoaded",function(){var e=mapSettings.map,t=e.pin?e.pin.url:mapSettings.themeurl+"/assets/pin.png",o=e.pin_highlighted?e.pin_highlighted.url:mapSettings.themeurl+"/assets/pin-highlighted.png",n=e.pin_center?e.pin_center.url:mapSettings.themeurl+"/assets/pin-center-2.png",a=e.zoom_level?e.zoom_level:14;mapboxgl.accessToken=mapSettings.access_token;var i=new mapboxgl.Map({container:"map",style:e.style,center:[e.center_point.longitude,e.center_point.latitude],zoom:a});e.show_controls&&i.addControl(new mapboxgl.NavigationControl),i.scrollZoom.disable();var l=[{name:"center-point",lat:e.center_point.latitude,lon:e.center_point.longitude,year:e.center_point.year,address:e.center_point.address},...e.points.map(e=>({name:e.name,lat:e.latitude,lon:e.longitude,year:e.year,address:e.address}))];const r=l.filter(e=>"center-point"!==e.name),c=new mapboxgl.Popup({closeButton:!0,closeOnClick:!1,offset:40});c.on("close",()=>{i.getSource("location-highlighted").setData({type:"FeatureCollection",features:[]})}),i.on("load",function(){i.loadImage(t,(e,t)=>{if(e)throw console.log(e),e;i.addImage("pin",t),i.addSource("locations",{type:"geojson",data:{type:"FeatureCollection",features:s(r)}}),i.addSource("locations-number",{type:"geojson",data:{type:"FeatureCollection",features:s(r)}});const o=!!i.getLayer("location-highlighted");i.addLayer({id:"locations",source:"locations",type:"symbol",layout:{"icon-image":"pin","icon-size":.8,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}},o?"location-highlighted":void 0),i.on("mouseenter","locations",()=>{i.getCanvas().style.cursor="pointer"}),i.on("mouseleave","locations",()=>{i.getCanvas().style.cursor=""}),i.on("click","locations",e=>{e.features[0]&&d(e.features[0].properties.name,e.features[0].properties.label)})}),i.loadImage(o,(e,t)=>{e||(i.addImage("pin-highlighted",t),i.addSource("location-highlighted",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i.addSource("location-highlighted-number",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),i.addLayer({id:"location-highlighted",source:"location-highlighted",type:"symbol",layout:{"icon-image":"pin-highlighted","icon-size":1.2,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}}))}),i.loadImage(n,(e,t)=>{if(e)return;i.addImage("pin-center",t);const o=[l.find(e=>"center-point"===e.name)];i.addSource("centerPoint",{type:"geojson",data:{type:"FeatureCollection",features:s(o)}}),i.addLayer({id:"centerPoint",source:"centerPoint",type:"symbol",layout:{"icon-image":"pin-center","icon-size":.9,"icon-allow-overlap":!1}})})});const s=(e,t)=>e.map((e,o)=>({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{label:t?t.toString():`${o+1}`,name:e.name,category:e.category}})),d=(e,t)=>{const o=i.getSource("location-highlighted"),n=i.getSource("location-highlighted-number");if(o&&n){const o=l.find(t=>t.name===e);if(!o)return;i.getSource("location-highlighted").setData({type:"FeatureCollection",features:s([o],t)}),i.getSource("location-highlighted-number").setData({type:"FeatureCollection",features:s([o],t)}),c.setLngLat([o.lon,o.lat]).setHTML(`<h6>${o.name}</h6><p>Active Since: ${o.year}</p><p>${o.address}</p>`).addTo(i),i.fitBounds(new mapboxgl.LngLatBounds([o.lon,o.lat],[o.lon,o.lat]),{maxZoom:a})}}});