document.addEventListener("DOMContentLoaded",function(){var e=mapSettings.map,t=e.pin?e.pin:mapSettings.themeurl+"/assets/pin.png",o=e.pin_highlighted?e.pin_highlighted:mapSettings.themeurl+"/assets/pin-highlighted.png",n=e.pin_center?e.pin_center:mapSettings.themeurl+"/assets/pin-center-2.png",a=e.zoom_level?e.zoom_level:14,i=mapSettings.themeurl+"/assets/dc-wards.geojson";mapboxgl.accessToken=mapSettings.access_token;var l=new mapboxgl.Map({container:"map",style:"mapbox://styles/duostudio/cllr572sa00nu01ma2yd573an",center:[e.center_point.longitude,e.center_point.latitude],zoom:a});e.show_controls&&l.addControl(new mapboxgl.NavigationControl),l.scrollZoom.disable();var c=[{name:"center-point",lat:e.center_point.latitude,lon:e.center_point.longitude},...e.points.map(e=>({name:e.name,lat:e.latitude,lon:e.longitude}))];const r=c.filter(e=>"center-point"!==e.name);l.on("load",function(){l.loadImage(t,(e,t)=>{if(e)throw console.log(e),e;l.addImage("pin",t),l.addSource("locations",{type:"geojson",data:{type:"FeatureCollection",features:d(r)}}),l.addSource("locations-number",{type:"geojson",data:{type:"FeatureCollection",features:d(r)}});const o=!!l.getLayer("location-highlighted");l.addLayer({id:"locations",source:"locations",type:"symbol",layout:{"icon-image":"pin","icon-size":.3,"text-field":["get","label"],"text-font":["Arial Unicode MS Bold"],"text-offset":[0,-.25],"text-size":12,"text-allow-overlap":!0,"text-ignore-placement":!0,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}},o?"location-highlighted":void 0),l.on("mouseenter","locations",()=>{l.getCanvas().style.cursor="pointer"}),l.on("mouseleave","locations",()=>{l.getCanvas().style.cursor=""}),l.on("click","locations",e=>{e.features[0]&&s(e.features[0].properties.name,e.features[0].properties.label)})}),l.loadImage(o,(e,t)=>{e||(l.addImage("pin-highlighted",t),l.addSource("location-highlighted",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.addSource("location-highlighted-number",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.addLayer({id:"location-highlighted",source:"location-highlighted",type:"symbol",layout:{"icon-image":"pin-highlighted","icon-size":.4,"text-field":["get","label"],"text-font":["Arial Unicode MS Bold"],"text-offset":[0,-.25],"text-size":12,"text-allow-overlap":!0,"text-ignore-placement":!0,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}}))}),l.loadImage(n,(e,t)=>{if(e)return;l.addImage("pin-center",t);const o=[c.find(e=>"center-point"===e.name)];l.addSource("centerPoint",{type:"geojson",data:{type:"FeatureCollection",features:d(o)}}),l.addLayer({id:"centerPoint",source:"centerPoint",type:"symbol",layout:{"icon-image":"pin-center","icon-size":.4,"icon-allow-overlap":!1}})}),l.addSource("dc-wards",{type:"geojson",data:i}),l.addLayer({id:"dc-wards-fill",type:"fill",source:"dc-wards",paint:{"fill-color":["match",["get","WARD"],1,"#f00",2,"#0f0",3,"#00f",4,"#ff0",5,"#f0f",6,"#0ff",7,"#f00",8,"#0f0","#ccc"],"fill-opacity":.4}}),l.addLayer({id:"dc-wards-line",type:"line",source:"dc-wards",paint:{"line-color":["match",["get","WARD"],1,"#f00",2,"#0f0",3,"#00f",4,"#ff0",5,"#f0f",6,"#0ff",7,"#f00",8,"#0f0","#ccc"],"line-width":1}}),l.on("click","dc-wards",function(e){console.log(e)})});const d=(e,t)=>e.map((e,o)=>({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{label:t?t.toString():`${o+1}`,name:e.name,category:e.category}})),s=(e,t)=>{const o=l.getSource("location-highlighted"),n=l.getSource("location-highlighted-number");if(o&&n){const o=c.find(t=>t.name===e);if(!o)return;{l.getSource("location-highlighted").setData({type:"FeatureCollection",features:d([o],t)}),l.getSource("location-highlighted-number").setData({type:"FeatureCollection",features:d([o],t)});const e=document.getElementById("map-popup"),n=document.getElementById("map-popup-title"),i=document.getElementById("map-popup-address"),c=document.getElementById("map-popup-url");e.style.display="block",n.textContent=o.name,i.textContent=o.address,c.href=`https://www.google.com/maps?q=${o.lat},${o.lon}`,l.fitBounds(new mapboxgl.LngLatBounds([o.lon,o.lat],[o.lon,o.lat]),{maxZoom:a})}}}});