document.addEventListener("DOMContentLoaded",function(){var e=mapSettings.map,t=e.pin?e.pin.url:mapSettings.themeurl+"/assets/pin.png",o=e.pin_highlighted?e.pin_highlighted.url:mapSettings.themeurl+"/assets/pin-highlighted.png",a=e.pin_center?e.pin_center.url:mapSettings.themeurl+"/assets/pin-center-2.png",n=e.zoom_level?e.zoom_level:14,i=mapSettings.themeurl+"/assets/dc-wards.geojson";mapboxgl.accessToken=mapSettings.access_token;var l=new mapboxgl.Map({container:"map",style:e.style,center:[e.center_point.longitude,e.center_point.latitude],zoom:n});e.show_controls&&l.addControl(new mapboxgl.NavigationControl),l.scrollZoom.disable();var r=[{name:"center-point",lat:e.center_point.latitude,lon:e.center_point.longitude,year:e.center_point.year,address:e.center_point.address},...e.points.map(e=>({name:e.name,lat:e.latitude,lon:e.longitude,year:e.year,address:e.address}))];const c=r.filter(e=>"center-point"!==e.name),s=new mapboxgl.Popup({closeButton:!0,closeOnClick:!1,offset:40});s.on("close",()=>{l.getSource("location-highlighted").setData({type:"FeatureCollection",features:[]})}),l.on("load",function(){l.addSource("dc-wards",{type:"geojson",data:i}),l.addLayer({id:"dc-wards-fill",type:"fill",source:"dc-wards",paint:{"fill-color":["match",["get","WARD"],1,"#fac831",2,"#d92314",3,"#0868f8",4,"#d92314",5,"#0868f8",6,"#fac831",7,"#d92314",8,"#0868f8","#0868f8"],"fill-opacity":.2}}),l.addLayer({id:"dc-wards-line",type:"line",source:"dc-wards",paint:{"line-color":["match",["get","WARD"],1,"#fac831",2,"#d92314",3,"#0868f8",4,"#d92314",5,"#0868f8",6,"#fac831",7,"#d92314",8,"#0868f8","#0868f8"],"line-width":1}}),l.loadImage(t,(e,t)=>{if(e)throw console.log(e),e;l.addImage("pin",t),l.addSource("locations",{type:"geojson",data:{type:"FeatureCollection",features:d(c)}}),l.addSource("locations-number",{type:"geojson",data:{type:"FeatureCollection",features:d(c)}});const o=!!l.getLayer("location-highlighted");l.addLayer({id:"locations",source:"locations",type:"symbol",layout:{"icon-image":"pin","icon-size":.8,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}},o?"location-highlighted":void 0),l.on("mouseenter","locations",()=>{l.getCanvas().style.cursor="pointer"}),l.on("mouseleave","locations",()=>{l.getCanvas().style.cursor=""}),l.on("click","locations",e=>{e.features[0]&&p(e.features[0].properties.name,e.features[0].properties.label)})}),l.loadImage(o,(e,t)=>{e||(l.addImage("pin-highlighted",t),l.addSource("location-highlighted",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.addSource("location-highlighted-number",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),l.addLayer({id:"location-highlighted",source:"location-highlighted",type:"symbol",layout:{"icon-image":"pin-highlighted","icon-size":1.2,"icon-allow-overlap":!0,"icon-ignore-placement":!0},paint:{"text-color":"#ffffff"}}))}),l.loadImage(a,(e,t)=>{if(e)return;l.addImage("pin-center",t);const o=[r.find(e=>"center-point"===e.name)];l.addSource("centerPoint",{type:"geojson",data:{type:"FeatureCollection",features:d(o)}}),l.addLayer({id:"centerPoint",source:"centerPoint",type:"symbol",layout:{"icon-image":"pin-center","icon-size":.9,"icon-allow-overlap":!1}})})});const d=(e,t)=>e.map((e,o)=>({type:"Feature",geometry:{type:"Point",coordinates:[e.lon,e.lat]},properties:{label:t?t.toString():`${o+1}`,name:e.name,category:e.category}})),p=(e,t)=>{const o=l.getSource("location-highlighted"),a=l.getSource("location-highlighted-number");if(o&&a){const o=r.find(t=>t.name===e);if(!o)return;l.getSource("location-highlighted").setData({type:"FeatureCollection",features:d([o],t)}),l.getSource("location-highlighted-number").setData({type:"FeatureCollection",features:d([o],t)}),s.setLngLat([o.lon,o.lat]).setHTML(`<h6>${o.name}</h6><p>Active Since: ${o.year}</p><p>${o.address}</p>`).addTo(l)}}});